


# 一、计算机网络：
:::alert-info
**网络**：有电信网络(提供电话、电报及传真等服务)、有线电视网络(提供电视节目)、计算机网络(提供信息、文件各种文件在计算机之间传送)。当然这三种网络可以合为一体，当然这其中牵涉到很大的商业利益，行政之类的问题。Internet中文译名有因特网和互联网，后者是使用更广泛的名字。互联网是一系列节点的链接可以互相通信，每个节点可以是计算机、路由器、交换机、集线器等。
:::
## a、概述：
:::alert-success
**发展**：第一阶段：由几台计算机连接，无论使用什么协议都互相可以通信。第二阶段：3级网络，分主干网、地区网、校园网，之后许多商业公司加入进来，政府将主干网让给企业控制。第三阶段：多层次isp（网络服务提供者，internet service provide）结构互联网，大ISP们建造通信网络设施，小isp们向他们购买ip，有了ip之后可以连接到网络。之后20世纪90年代欧洲原子核研究组织CERN开发万维网www，得到推广，很大的方便了非网络专员对网络的使用，推动了互联网的迅速发展。
中国于1994年连如互联网，在网站`http://www.cnnic.cn`可查看中国互联网发展情况，一年两次更新。
:::
**体系结构**：第一个计算机网络`ARPNET`设计时提出分层的概念。计算机互联的主要目的是资源共享。通讯系统必须具备的**3个要素**：信源、通信媒体、信宿。
对等层：网络体系结构中，通信双方实现同样功能的层。
**组成元素**：
- 网络软件：网络协议、通信软件、网络操作系统等。
- 网络硬件：网络节点（网络单元）。

**计算机网络分类**：
1. **按范围分类**：
（1）广域网：覆盖几十~几千公里的范围，一个国家甚至跨国。
（2）城域网：5~50km，通常覆盖一个城市。
（3）局域网：学校、企业之类的单位使用。
（4）个人区域网：自己家的设备连接到同一个网络上就能形成一个个人区域网。
2. 按交换方式分类：电路交换（主要用于电话网）、报文交换、分组交换。
3. 按拓扑结构分类：集中式网络、分散式网络、分布式网络。
4. 按使用范围分类：公用网（访问远程信息，个人间通信、交互式娱乐）、专用网（资源共享、提高可靠性、节约经费）。

层次概览：
1. 物理层：物理层上传送的数据单位为bit，数据都是0,1，物理层决定使用多大的电压，电缆插头以多少引角连接，接受数据等，而使用的物理媒体（电缆线、双绞线等）在物理层之下。
一个传输示例：主机1的进程a1向主机2的进程a2发送信息，a1将信息交给5层(应用层)，数据向下传递，每层添加自己的控制信息，<b class="green">到第2层控制信息被分为两部分，分别被加到该层数据单元的首部和尾部。到物理层由于是bit流传输，所以不加控制信息。</b>数据流经过物理媒体到达路由器，从路由器1层到3层，进行相应操作每层剥去一层控制，将数据上送到上一层，到第3层时会去掉读取头部，获取目的地地址，**然后到路由表中查找转发分组接口**，然后吓到第2层，加上新的头部和尾部，到1层再传输去目标计算机。到达目标机器后再从1层升至5层，然后交给a2.
2. 链路层：数据的传输是在一段段链路上传送的！将网络层交下来的ip数据报组装成帧（帧中包含数据和控制信息）。接收数据时接收到一个帧将数据解析出来上交给网络层。
3. 网络层：（网际层/ip层）为不同计算机提供通信服务。发送数据时将运输层产生的数据封装成组或包进行传送，另一个作用是选择合适的路由，使得能找到目标主机。
4. 运输层：向主机进程之间的通信提供通用（多个网络应用可共用）的数据传输服务，应用进程利用该服务传送应用层报文。
5. 应用层：最高层，应用进程间的交互完成特定网络应用，对不同的网络应用需要不同的应用层协议，如域名系统的DNS，支持万维网的http，支持邮寄的SMTP，用户层交互的数据单元称为报文。

**数据流动**：
![internet_data](vx_images/3922845161158.png =400x)

**各层主要设备**：**应用层**（应用网关），**传输层**（传输网关），**网络层**（路由器、三层交换机），**数据链路层**（网桥、普通交换机），**物理层**（中继器、集线器）。

**网关**：又称网间连接器、协议转换器。网关在网络层以上实现网络互连，是复杂的网络互连设备，仅用于两个高层协议不同的网络互连。
>网关既可以用于广域网互连，也可以用于局域网互连。 网关是一种充当转换重任的计算机系统或设备。使用在不同的通信协议、数据格式或语言，甚至体系结构完全不同的两种系统之间，网关是一个翻译器。
><b c=gn>由于历史的原因，许多有关TCP/IP的文献曾经把**网络层使用的路由器称为网关**，现在很多局域网采用都是路由来接入网络，**因此通常指的网关就是路由器的IP**！实质上是一个网络通向其他网络的IP地址</b>。

**中继器**：
- (Repeater)是连接网络线路的一种装置,常用于两个网络节点之间物理信号的双向转发工作。
- 中继器是最简单的网络互联设备,主要完成物理层的功能,负责在两个节点的物理层上按位传递信息,完成信号的复制、调整和放大功能,以此来延长网络的长度。
- 就是简单的信号放大器，信号在传输的过程中是要衰减的，中继器的作用就是将信号放大，使信号能传的更远。

**集线器**：
- 英文称为“Hub”。“Hub”是“中心”的意思，集线器的主要功能是对接收到的信号进行再生整形放大，以扩大网络的传输距离，同时把所有节点集中在以它为中心的节点上。
- 属于纯硬件网络底层设备，基本上不具有类似于交换机的"智能记忆"能力和"学习"能力。它也不具备交换机所具有的MAC地址表，所以它发送数据时都是没有针对性的，而是采用广播方式发送。

**网桥**：
- 也叫桥接器，是连接两个局域网的一种**存储/转发**设备，它能将一个大的LAN分割为多个网段，或将两个以上的LAN互联为一个逻辑LAN，使LAN上的所有用户都可访问服务器。
- 网桥是一种对帧进行转发的技术，根据MAC分区块，可隔离碰撞。网桥将网络的同一网段在数据链路层连接起来，只能连接同构网络(同一网段)，不能连接异构网络（不同网段）。
- 扩展局域网最常见的方法是使用网桥。最简单的网桥有两个端口，复杂些的网桥可以有更多的端口。网桥的每个端口与一个网段相连。

**交换机**：
- (Switch)意为“开关”是一种用于电（光）信号转发的网络设备。它可以为接入交换机的任意两个网络节点提供独享的电信号通路。
- 最常见的交换机是以太网交换机。其他常见的还有电话语音交换机、光纤交换机等。
- 交换是按照通信两端传输信息的需要，用人工或设备自动完成的方法，把要传输的信息送到符合要求的相应路由上的技术的统称。

**路由器**：在访问不同网络时使用，路由中存放（目的网络地址，吓一跳地址），这个目的网络地址并非某一计算机的具体地址。<b class="green">路由器有自己的ip地址和物理地址</b>
- **路由器结构**：有一组输入端口（进入的分组在这里排队，如果分组处理的速度跟不上转发速度，这里的队列会很长，导致空间占满，**丢失帧**）、一组输出端口（使用的是一根总线结构，一个分组转出时占据全部总线）、路由选择部分、分组转发部分。
- **路由选择处理机**：路由器，路由选择部分的核心，<b c=b>负责构造、更新和维护路由表。</b>
- 静态路由：网络管理员手工配置路由信息，网络拓扑结构或链路变化时需要管理员更改，静态路由信息默认情况下是私有的，不会传递给其他路由。适合简单网络环境。
- 动态路由：路由器能自动建立路由表，并根据变化自行调整。
- **路由选择协议**：因为个网络访问的用户数量不同，且不同时间也不同，所以即使网络拓扑结构不变化也不能保证每次通信的时间一样，会出现通过更多路由访问目标网络也可能比更少的其它几个路由访问网络要快的现象，为此应该使用动态路由。
- **路由协议分为两类**：
>内部网关控议`IGP`(interior Gateway protocol)（一个自制系统内部使用，常用的有RIP,OSPF）。
>外部网关协议`EGP`(External Gateway Protocol)（转发的分组到达自治系统边界时，该网络使用的控制协议，常用的有BGP）。

**三层交换机**：具有部分路由器功能的交换机，工作在OSI网络标准模型的第三层：网络层。三层交换机的最重要目的是加快大型局域网内部的数据交换，所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。

**传输协议**：计算机之间的通信比较复杂（知道对方是否可连接、知道对方的是否可接收、数据格式是否符合、出错处理等等）。
>网络协议主要要素为：<b c=v>语法、语义、同步</b>
>最早的国际传输标准为OSI，不过由于协议复杂、低效、重复因此废弃，而市面上流行使用TCP/IP协议，所以它成为了实际上的标准。

**OSI体系结构**：7层体系结构
（1）物理层；
（2）数据链路层（实现二进制正确传输，为上一层提供可靠无错误的数据信息）；
（3）网络层
（4）运输层（提供端到端服务，为两台主机进程之间提供通信服务）；
（5）会话层（会话管理和同步）；
（6）表示层；
（7）应用层。
**TCP/IP体系结构**：4层体系结构（延用了osi模型相应标准）。**实际使用的体系结构**。<b c=gn>网络接口层，网际层对应OSI体系中的物理层、数据链路层、网络层</b>
（1）网络接口层；
（2）网际层（网络层，解决主机之间通信，不同网络互联问题）；
（3）运输层
（4）应用层
**五层协议体系结构**：（介绍网络原理使用的），物理层、数据链路层、网络层、运输层、应用层。
<b class="gray">发送数据时发送方数据是从应用层流到物理层发送出去，接收方是从物理层接收，数据逐层到应用层。</b>
对应关系：
![3种体系结构对应关系](_v_images/3933238140960.png =464x)


**带宽**：计算机网络中用来表示传输数据的能力。
- <b c=gn>单位时间内通过信道某一截面的数据量，而非整条信道</b>。<b c=b>所以传播多久还要看双方距离，信道长度。也就是下面的传播时延</b>
- **实际情况下**单位时间内网络中某信道所通过的最高数据率。一般bit/s为单位（bps）。

**信道传输率**：与带宽有区别，单位也是bps，不过是指最大情况下的数据传输率。
**波特率**：表示单位时间内传送的码元符号的个数，它是对符号传输速率的一种度量，2倍的信道带宽。
**bps**：数据传输单位，就是bit/s，有Mbps，Gbps表示相应的大小。
**时延**：
- 发送时延：主机或路由器发送数据帧所需时间，数据帧长度(bit) / 发送速率(bit/s)。
- 传播时延：电磁波在信道中传播的时间，信道长度 / 电磁波传输速率。
- 处理时延：主机或路由器在收到分组时要花费时间处理（如分析分组首部、分组中获取数据等）。
- 排队时延：分组很多时它们需要排队等待主机或路由器的处理。

**吞吐量**：单位时间内通过某个网络（或信道，接口）的实际数据量。<b c=b>计算时要加上等待、发送、传播等时延</b>。`吞吐量=一个窗口的数据/到下次发送的时间间隔`
实体：表示任何可接收发送信息的软件或硬件进程。
协议：控制两个或多个对等实体进行通信的规则的集合。
服务：在协议的作用下使得两个实体在本层的通信上可以为上一层提供一个服务，所以协议是水平的（该层的通信控制），而服务是垂直的。
服务访问点：两层进行交互的地方称为SAP（service access point）。

![tcpip](_v_images/20201218000330003_10484.png =603x)
## b、物理层：
**主要作用**：在各种不同的计算机媒体间传输比特流，解决它们的差异
数据通信基础知识：通信专业知识，数据发送通过源站点(发送bit流)->发送器(常用**调制解调器**[进行编码]，多内置于计算机)->传输系统->调制解调器->目标站点。
- 模拟线号：连续的线号，代表消息的参数取值是连续的。<b c=gn>模拟数据和数字数据都可以用模拟信号和数字信号传输</b>
- 数字线号：离散得线号，消息的参数取值是离散得。<b c=gn>传输数字信号的多路复用技术是：同步和异步TDM。</b>
- 单向通信：单工通信，只有一个方向的通信（发送/接收），如电视、广播等媒体。
- 双向交替通信：**半双工**。可以双方互相发送信息，但不能同时发送。一方向另一方发送信息，另一方接收，过一段时间后又反过来。<b c=r>但还是需要两条信道</b>
- 双向同时通信：**全双工通信**。双方可以同时发送和接收，有两条信道，效率很高。
- 常用编码方式：不归零制：正电平代表1，负电平代表0。归零制：正脉冲代表1，负脉冲代表0。
- 曼彻斯特编码：一种同步时钟编码技术，时钟和数据一起包含在数据流中传输（中间的跳变即做时钟信号，又做数据信号）。周期中心向上跳变代表0，向下跳变代表1。
- 差分曼彻斯特编码：每一位中心处始终跳变，开始边界有跳变则代表0，没有跳变则代表1。<b c=r>脉冲中间时刻始终发生跳变</b>
![encode](_v_images/20201218214246963_30723.png =604x)
**虚电路**：一种传输方式，需要事先在通信双方之间建立逻辑链路，此后的分组传输将根据虚电路表迅速被转发。**造成延迟主要原因**是虚电路的建立时间，而不是交换机的存储转发过程。
链路：连接两端，实现通信的物理通道。
数据链路：基于链路这个物理通道上，还要按一些规制，实现的数据的传输方式。

**数据交换方式**：
- 电路交换：整个报文的比特流连续地从源点直达终点。电话网使用，中间有调制解调器（实现比特率和模拟信号的互转），电话网中使用模拟信号传输
>优点：（1）既适用于传输模拟信号，也适用于传输数字信号。（2）独占链路，所以传输时延最小、实时性强、不存在失序问题
>缺点：（1）独占链路，所以信道利用率低（2）没有差错控制
- 报文交换：
（1）整个报文先传送到相邻节点，全部存储下来后查找转发表。转发到下一个节点。
（2）报文不按顺序到达目的地。存储接收到的报文，判断其目标地址以选择路由，最后，在下一跳路由空闲时，将数据转发给下一跳路由。
（3）报文交换系统现今都由分组交换或电路交换网络所承载。
- 分组交换：
（1）将整个报文分为几组，单个分组传送到相邻节点，存储下来后查找转发表，转到下一个节点。
（2）现计算机网络使用，时延比报文交换低。

**信道的极限容量**：任何实际的信道都是不理想的，不可能以任意高的速率进行传送，实际信道带宽受限、有噪声、干扰和失真，不过如果接收端能识别失真之前的信号，这依然是可行的。
- **频率范围**：这是有限的，信号中的**高频分量**（信号流中波形的数量）往往很难通过。任何信道中码云传输速率超过上限就会出现严重的**码间串扰**（传输后，信号波形被拖长甚至波形直接变样）现象，信号频带越宽，能通过的高频分量就越多。<b c=r>频带宽度简称带宽，上限与所用材料有关，当然端点除可以控制最高带宽</b>

**信噪比**：噪声存在于任何电子设备中，且是随机产生的，它会干扰信号，可能导致将信号中的某个0变成1，信号较强，噪声的影响会相对较小，所以`Q(功率比)=信号平均功率/噪声平均功率`，后两者比值用S/N表示，用dB作为度量单位。$S/N=10*log_{10}Q （dB）$，`Q=1000时，S/N=30dB`。<b c=b>某音箱的信噪比为`80dB`，即输出信号功率是噪音功率的`10^8`倍</b>

**信道传输率**：
>**有噪声情况下**，信道**极限信息传输速率**C，香农公式指出：$C=W*log_2 (1+S/N) (bit/s)$#W是信道带宽(转为Hz)，单位为Hz。<b c=v>计算时将S/N转Wie功率比，不用dB</b>
>**无噪声情况下**，极限传输速率：$B=2W,C=B\log_2M$#B为波特率，M为编码模式数目（多少种物理状态表示数据），W是信道带宽频率，以Hz为基本单位时C单位为bps，**kHz时C对应单位为kbps**。

**频分复用**：`FDM`，所有用户在同样的时间占用不同的带宽资源。
**时分复用**：`TDM`，所有的用户在不同的时间占用带宽资源。
- 同步TDM：每个用户占用时隙周期的出现，根据使用的时间片就能区分是谁的数据。
- 统计TDM：按需要动态的为用户分配，需要解决好传输中的**同步和成帧**问题。

**波分复用**：光的频分复用。
**码分复用**：`CDM`，另一种共享信道的方法，由于为每一个用户挑选的码型不一样，所以可以同一时间使用同一信道而不影响，有很强抗干扰能力，现在多用于无线局域网。
**带宽接入技术**：早期用户是通过电话的用户线通过调制解调器连接到ISP，即**拨号上网**，速度只能达到56kbit/s，之后使用带宽接（下行速率25Mbit/s，上行速率3Mbit/s）入，提高了速度，有有线带宽和无线带宽之分。
**FTTX技术**：光纤到户为FTTH技术。光纤传输的是光线号速度快，到用户家后才会转换为电信号。而其它宽带则是直接传输电信号。光纤能达到100Mbit/s的速度，不过比较昂贵且多数家庭只需要几Mbit/s的速度即可，FTTX是将光电转换点放到离用户家有一段距离的地方，这样来控制速度和成本。

**传输介质**：
双绞线：两根互相绝缘的铜导线并排放一起，然后用规则方法绞合起来（绞合可减少导线间磁力影响）
同轴电缆：外向内是：绝缘套、外导体屏蔽层、绝缘层、内导体。广泛用于高速率数据传输
光纤：用光导纤维传输光脉冲。

**接口特性**：
1. 机械特性：指明接口所用接线器的形状，尺寸、引线数目等。
2. 电气特性：接口电缆的各条线路上出现的电压范围。
3. 功能特性：指明某线路上出现的某一电平电压表示何意。
4. 规程特性：说明对于不同功能的各种可能事件的出现顺序。

- **集线器**：工作在物理层，只对各计算机的bit数据进行转发。
以太网的MAC层：也叫物理地址、硬件地址。准确的说它是适配器的物理地址而不是计算机的物理地址。要生成局域网适配器的厂家都需要向IEEE的**注册管理机构RA**申请MAC地址的前3个字节（如02-60-8c），后3个字节有各厂家自行配置。
物理层扩展以太网：使用多个集线器分块连接各块的计算机，然后再用一个集线器将这些集线器连接起来。
## c、数据链路层：

链路：一个节点到相邻节点的物理路线，中间没有交换点，计算机的通信路径有很多如此节点，是路径的一部分。<b c=gn>两端链路间有交换设备，勿忽略此处的发送、处理、排队时延</b>
数据链路：在链路上传输数据时还需加上协议，实现这些协议的软硬件都加到链路上来就形成了数据链路。通常使用**网络适配器**(包含软硬件，多包含数据链路层和物理层的功能)。
**数据帧**：每帧长度为数据帧的长度范围：(46＋18)~(1500＋18)。首部长14，尾部长4。

**功能**：
- 基本：把网络层交下来的ip数据报上添加**首部和尾部**（作为帧界限，和包含一些控制信息）封装成帧发送到链路上，把收到的帧中的数据取出来上交给网络层。
数据链路层使用的信道的两种类型：点对点通信信道、广播信道（一对多）。
- 透明传输：加上的首部为SOH，尾部为EOT。如果传输的是ascii码的文本数据时，若数据中也出现EOT（00000100），则接受方识别到此处会直接中断此帧。
>解决：为了解决这种透明传输问题的方法是在数据的SOH或EOT前加入转义字符ESC。

- **差错检测**：数据在传输过程中是会出现错误的，比如0变为1，这跟信噪比有关，但即使降低信噪比依然会出现不少的传输错误。
现在链路层中广泛使用**循环冗余检测方法**检错。其它差错问题：帧丢失、帧重复、帧失序。
- 流量控制：通过限制双方发送流量速度不超过其接收方速度来控制。数据链路层对等实体间进行。
- 路线控制：提供连接的建立、维持和释放，实现链路管理

**局域网**：
- **IEE802.11标准**：规定了物理层和数据链路层。将链路层分为介质访问控制MAC，和逻辑访问控制LLC。
- IEE802.3标准：规定了采用总线型拓扑结构和基带传输方法，使用CSMA/CD介质访问控制。小于64字节的帧被称为碎片帧

- 局域网类型：总线网（多台计算机连接到一条总线上）、星形网、环形网。局域网的数据链路层使用的是广播信道。
- **以太网**：符合DIX Enternet V2标准的局域网。不过数据链路层中不只这一个标准。
- **适配器**：计算机与外界网的链接通过适配器进行（进行数据串行和并行传输的转换），早期是使用一块PCMCIA卡，又称网络接口卡NIC，简称**网卡**。现在多数计算机内置了这种适配器。即网络适配器，包含数据链路层和物理层功能，不过由于现在的集成技术很好，内部并不是会分的那么清晰。以太网为保通信简便采取的两个措施：
（1）、不先建立连接就直接发送数据，适配器对发送的数据帧不进行编号，也不要求对方发回确认。这是尽量的提高发送速率而出错是否重传这些由高层决定。一台计算机在发送数据时就会占用总线资源，若其它计算机也发送就会出现互相干扰情况，所以使用CSMA/CD协议（载波监听多点接入/碰撞检测）控制让一台计算机发送结束后另一台再发送，若出现多台同时干扰情况则直接结束所有发送。
（2）、使用曼彻斯特编码。CSMA/CD协议不能同时接收和发送，因此它不能使用全双工模式。

- **CSMA协议**：载波侦听（Carrier Sense） 是一种介质访问控制（MAC）的协议。
（1）任何连接到介质的设备在欲发送帧前，必须对介质进行侦听，当确认其空闲时，才可以发送。 
（2）多路访问（Multiple Access） 指多个设备可以同时访问介质，一个设备发送的帧也可以被多个设备接收。
- **CSMA/CA协议**：载波多路访问在物理层和虚拟层上进行。物理层上与CSMA/CD几乎一致。虚拟层上载波检测通过获取其它站点要占用介质通道的消息，而延迟发送实现避免冲突。
避免冲突具体方法：<b c=r>无线局域网采用此协议</b>
（1）预约信道：告知其它站点即将发送数据，占用多长时间
（2）正向确认机制：收到目标消息的站点要向发送方发送ACK确认帧
（3）RTS/CTS机制：请求发送RTS/允许发送CTS选项，解决隐蔽站的冲突

- **CSMA/CD协议**：以太网使用协议，IEE802.3标准中使用的协议。
（1）适配器从网络层获得一个分组（ip数据报），加上以太网首部和尾部，组成以太网帧，放入适配器缓存，发送前先检测信道。
（2）、进行信道检测，直到检测到信道空闲，并在96比特时间内是空闲的，然后发送这个帧。
（3）、边发送边监听，若发送中一直未检测到碰撞则发送成功，否则发送失败执行指数退避算法。
- **令牌传递协议**：
（1）令牌传递又称“标记传送”（实际上是一个特殊格式的帧，本身并不包含信息），局部网数据送取的一种控制方法，多用于环形网。
（2）令牌是一个有特殊目的信息段，它的作用是允许站点进行数据发送。一个站点只有在持有令牌时才能发送数据。
（3）令牌是沿着环发送的专门的消息。当某站有包发送时，等待令牌到达，得到令牌后先发送包，再发送令牌。
（4）**令牌环网**：
    1. 令牌环网的媒体接入控制机制采用的是分布式控制模式的循环方法。
    2. 在令牌环网中有一个令牌(Token)沿着环形总线在入网节点计算机间依次传递，仅控制信道的使用，确保在同一时刻只有一个节点能够独占信道。
    3. 当环上节点都空闲时，令牌绕环行进。节点计算机只有取得令牌后才能发送数据帧，因此不会发生碰撞。

- **星形网**：中间使用一个集线器，各台计算机使用两条双绞线(在一条光缆内)连接到集线器，10BASE-T的出现使得总线形网变为星形。不过逻辑上使用的还是总线网，共享使用的也是CSMA/DC协议。

**设备**：
 **普通交换机**：在vlan中作用：实现VLAN划分，交换VLAN成员信息、VLAN中进行数据帧的交换。
- **存储转发方式**：
（1）转发前要对帧进行错误校验，出错的帧不转发，节省带宽。
（2）有帧缓冲功能，支持不同速率端口之间进行转发。
（3）帧完整接收后才进行转发，所以延迟大。
（4）缓冲区大小有限，负载重时帧还是会被丢弃。
- **直通转发方式**：几乎与存储转发相反。
（1）转发前不进行错误校验，出错的帧也会转发。
（2）无帧缓冲能力，不同速率端口不可通信。
（3）收到一帧最前面的地址就会开始转发，延迟小。
（4）无丢帧现象，负载不影响性能。

- **虚拟局域网**：可以让不同局域网下的计算机组成一个虚拟局域网，便于用户使用资源。每个以太网使用交换机连接，在虚拟局域网下的计算机发送数据时，每一帧数据中都含有属于虚拟局域网的标识符。所以不会影响同一以太网下的其它计算机发送数据。 
高速以太网：从传统的10Mbit/s的以太网到现在的1Gbit/s的吉比特甚至更快的以太网。
1. 100BASE-T以太网：双绞线，星形以太网的基础上将适配器改换为100Mbit/s的，再跟换100Mbit/s的集线器或交换机即可从10BASE-T以太网升级到100BASE-T。
2. 吉比特以太网：允许在1Gbit/s下使用全双工后半双工，半双工下使用CSMA/CD协议，全双工下不使用该协议。
3. 10吉比特以太网。

**停止等待协议**：每发送完一个分组就停止发送，**等待对方的确认**（发送一个ACK帧）<b c=b>注意信道效率的计算</b>。超时时间比较短时，需要序号。
**ARQ**：停止等待协议的分组确认方式的信道利用率太低，`ARQ是其上的改进`。
- 停止等待ARQ协：数据报文发送完成之后，发送方等待接收方的状态报告，如果状态报告报文发送成功，发送后续的数据报文，否则重传该报文。
- **连续ARQ协议**：使用多个分组连续发送的方式，而接收方只需要确认该次连续的最后一个分组即可（即使中间有分组丢失也不知道）。发送方将窗口向前移动一位，继续从后续的编号开始发送窗口内的数据

**HDLC协议**：（早期使用，现较少使用）一种面向比特的高效链路层协议。
- 帧结构：| F(标志域) | A(地址域：标识从站地址) | `C(控制域：用于区分3种帧格式)` | INFO(信息域：I帧和某些无编号帧含有) | FCS(帧校验和域：有校验序列) |
   帧类型如下：
- 信息帧（I帧）：传送有效信息
- 监控帧（S帧）：用于差错控制和流量控制，轮询和旋转
- 无编号帧（U帧）：提供对链路的建立、拆除等多种控制功能

**ppp协议**：（目前使用较多）用户计算机与isp进行通信时链路层使用的协议。由网络控制协议NCP、链路控制协议LCP（接入isp时为用户分配ip）、一个将ip数据报封装到串行链路的方法。
- 字节填充：进行异步传输时，把转义为0x7D，并使用字节填充。
- 零比特填充：ppp协议使用SONET/SDH链路时使用同步传输，此时使用零比特填充方法实现透明传输。

## d、网络层：
:::alert-dark
概述：网络层属于核心部分内容，网络层向上只提供简单灵活、无连接、尽最大努力交付的数据服务。而不提供服务质量的承若。这种优势在于运行灵活、适合多种网络应用的要求、网络造价低。
网际协议ip：TCP/IP体系中最主要的协议之一，与之配套使用的3个协议还有：ARP(地址解析协议Address Resolution Protocol)、ICMP(网际控制报文协议Internet Control Message Protocol)、IGMP(Internet Group Message Protocol)。<b c=r>解决主机之间通信问题</b>
:::

**拥塞控制**：流量控制，接收出缓冲区开始溢出时，将拥塞信号发回源地址
- 拥塞原因：网络负担大，分组多、路由处理慢、路由缓冲区小。
- 防止阻塞方法：滑动窗口、预约缓冲区、许可证、分组丢弃。

**ip地址**：由**网络号**(如145.13.0.0中的`145.13`为网络号)和**主机号**构成，ip又分为A,B,C3类，没类的网络号，主机号的位长不同（**IP地址位数=网络位数+主机位数=32位**）。
1. 地址分类：如图
![ip](_v_images/3274211110966.png =409x)
- **A类地址**：**8位**，开头0，1位被固定。
（1）**7位网络号可用**，**可指派**`2^7 - 2 = 126`个。
（2）主机号有3个字节，有`2^24 - 2`个可用。整个A类ip地址有`2^31`个，占所有ip地址的50%。全1的主机号字段表示该网络上的所有主机。
（3）**范围**从`1.0.0.0-126.255.255.255`，可用的A类网络有126个；
- **B类地址**：**16位**，网络号有两位已经固定，**前两位已固定为10**，所以**网络号可用14位**.
（1）128.0.0.0不会被分配，所以可用的ip有`2^14 - 1`个。最小网络地址:`128.1.0.0`
（2）**范围**从`128.0.0.0-191.255.255.255`。可用的B类网络有**16382**个；
- **C类地址**：**24位**，有3个网络号已固定`110`，还有**21位网络号可用**，
（1）192.0.0.0也不分配。共有`2^29个地址`，占全部的12.5%。最小地址为`192.0.1.0`；
（2）**范围**从`192.0.0.0-223.255.255.255`。C类网络可达209万余个
- **D类地址**：为多播地址，主机进行多播时会使用到。E类地址未使用！**范围**在`224.0.0.1-239.255.255.255`。
- <b c=gn>全0是本机地址，全1是本地广播地址。127.0.0.1为环回测试号（本主机进程间通信使用）</b>

2. 相关协议：
- **CIDR**：无分类编地方法，且使用两级地址`{网络前缀，主机号}`构成，不划分子网。
（1）写法类似于128.14.35.7/20，/20表示网络号占20位。称为一个块，每个块的主机的ip地址的前缀一样。总位数不变，依然是32位，<b c="b">
（2）所以根据前缀（网络号）就知道其使用了多少位，然后剩余的位数为主机号可随意分配，如剩余10位主机号则该块可分配`2^10`个ip。</b>
    - 这样的分配方法不会造成网络数的增加，所以能减少路由表长度的负担。
    - ip地址利用率高、子网划分更加灵活、不仅能划分子网也能合并超网。

- **ARP地址解析协议**：从数据链路层**解析物理地址**，获取ip地址。所以ARP属于网络层也可以属于数据链路层。每台主机都有一个ARP高速缓存，存储本局域网上该主机知道的ip地址到物理地址，而且会经常更新。所以也完成ip地址到物理地址的映射。
>**示例**：主机A向B发送信息，会先在本机ARP缓存中查找其ip及对应mac地址，若没找到或A刚入电，B刚入网等没有记录，
那么A会想本局域网内发送一个广播（单播）发送ARP分组信息(包含目标主机地址和本机地址)，
若主机B收到该ARP分组，与自己的地址对比，一致则向A响应自己的物理地址。A收到后将其写入ARP缓存中（可能几十分钟后会删除）。因此，**ARP无法解析不同局域网的地址**。

**物理地址**：在传输数据时经过网络层时ip地址会被封装进每一帧的数据报的首段，进入数据链路层后会再将物理地址封装到每一帧首部，即MAC帧（<b c="gn">会将原地址和目标地址都添加进去</b>）。若途经路由器等不同网络会将mac中的原地址和目标物理地址更换。

**网络层ip数据报内容如下**：
![ipData](_v_images/20201222140802054_22650.png =552x)
- 版本：ip协议的版本号。！占4位。
- 首部长度：数据报首部的长度。固定**20字节长**。
- 区分服务：用来获得更好的服务，使用区分服务时改段才有用。
- 总长度：首部和数据的总长度。<b c=gn>总长度=首部长度+数据部分长度</b>
- 标识：ip软件在缓存中会维持一个计数器，没产生一个数据报该计算器+1，然后赋值给标识字段（非序号标识）。
- 标志：有3位，最后一位记为MF，**为1标识后面还有数据报片段**，为0表示已经是最后一个片段。第二位记为DF，为0时才允许分片（帧）。
- 片偏移：该帧在该数据的所有帧中的相对位置。**以8个字节为偏移单位**。<b c=b>数据长度应该能被8整除，且是小于每次可传片长的最大值</b>
- 生存时间：Time to Live，数据报寿命，为防止数据报一直存留于互联网中。每经过一次路由器就减去在该路由中消耗的时间，为0时则丢弃该帧数据。
- 协议：指定该数据报的数据使用何种协议，目标主机ip层收到后将数据交由相关协议处理数据。
- 首部检验和：检验首部，不包含数据。每次经过路由器时都会经过一次检验（生存时间、片偏移等）。
- 可变部分：用于支持排错、测量、安全等作用。

**ip多播**：早期互联网中一台主机要向不同的其它主机发送同一份数据时是需要建立多个分组来分发这些数据，这是极其浪费资源的。1992年提出ip多播，只需要发送一个分组，到路由器后由其识别是多播，将数据复制多份再发送给对应的主机。能识别处理这种多播的分组报文也称为多播路由器。
- IGMP：网际组管理协议。让本地局域网上的路由器知道哪些主机参与了多播。<b c="r">！！！未讲解清楚ip多播原理</b>

单播传输：发送者和每一个接受者之间建立点对点传播。
组播传输：即ip多播。
广播传输：ip子网内广播数据包，所有子网内的主机都会收到这个数据包。

**移动ip**：为让移动设备用户，能够从一个网上系统中，移动到另一个网上系统，但是设备的IP地址保持不变。
- 制定的一种网上传输协议标准。设有一个主地址，和辅地址。
- 返回本地网后，要向本地代理注销辅地址。
- 移动主机在不同子网通信过程：
（1）本地代理不停的向网上发送代理广告信息，来声明自己的存在。
（2）移动主机收到这些消息，确定自己是在本地网还是外地网。
（3）若在本地网，则不启动移动功能。若不在本地网，则向本地代理发出取消注册的信息，声明自己回到了本地网。
（4）移动主机检测到它移动到外地网时，则获得接管地址（CoA）
（5）然后移动主机向本地代理登记，表明自己离开本地网，把所获得的接管地址通知本地代理。
（6）登记完毕后，所有发给移动主机的数据包被本地代理截获，本地代理解封后，通过隧道发到外地网络的外地代理FA（第一种CoA，外地代理再把数据包转给移动主机），或移动主机自身（第二种CoA）
（7）移动主机发送数据到一般ip设备时，正常寻址发送即可，不要通过本地代理。

**划分子网和构造超网**：上面所诉的两级ip地址利用率低(一公司申请到一个B类地址，但主机数不够又考虑以后公司的发展不想更换c类地址)、不够灵活（申请到新的ip地址前新加的网络不能连到互联网）、给每一个物理网分配一个网络号会使路由表变得很大而降低网络性能。
**划分子网**：对外任然表现为一个网络，从主机号借走若干位作为子网号，两级ip地址变为了3级》网络号，子网号，主机号。如：145.13.3.0是一个子网，其下有145.13.3.7、145.13.3.145。
**子网掩码**：从ip数据报中无法分辨是到达哪个子网，所以使用子网掩码。
（1）若是两极ip地址：145.13.3.0的子网掩码为`11111111111111110000000000000000`#没段8位。
（2）而如果时3级ip地址：145.13.3.0的子网掩码为`11111111111111111111111100000000`#外部写为255.255.255.0。这也让路由器直接将数据传到子网
（3）<b c="v">（因为被划分为子网后子网也想到于一个网络，各子网的网络号会被存到路由表中，而根据网络号找到最近的路由表时这个路由需要从子网列表中选中具体那个）</b>。
（4）<b c="b">子网掩码会被逐位的与ip地址进行与运算，得出网络地址。不划分子网也可以使用子网掩码。！划分子网会减少可连接的主机数量。</b>
- **网络地址运算示例**：目标主机地址为141.14.72.24，子网隐码为255.255.192.0。=》将ip和子网掩码全部改为二进制表示，然后各段做与运算，得出网络地址》141.14.64.0。
- **划分子网示例**：子网的划分是从主机号中（B类地址最后的16位都是主机号，C类地址最后的8位是主机号）借走几位做网络号。
（1）比如下图第二行最后8位借走2位（从左到右1的位数就是借走的）做网络号，就变成`11000000`#借走不同的位数相应的都可以可划分为多个子网数。
（2）因为ip与子网掩码做与运算得出网络号，所以11000000与`10....0`(10开头的主机号)，`01....0`(01开头的主机号)，`00...0`(00开头的主机号)还有11开头的主机号做与运算。
（3）这样就会得到4个不同的网络号，对应的4个子网，一般子网下的主机数是一样的，所以下表中每行**借走的主机号位数不同子，网数也不同**。
（4）<b c=r>全0的主机号表示本机号，全1是多播地址用，所以划分子网主机号至少要保留2位</b>。[参考学习地址](https://zhidao.baidu.com/question/575672378.html)
![划分子网示例](_v_images/4916113220457.png =340x)

**使用子网时分组的转发**：子网主机H1向子网主机H2通信，过程如下：
1. H1使用自身的子网掩码和目标ip计算网络地址，**若与本机的网络地址不同说明和自己不在一个子网上**，需要使用路由转发分组（进入2）。若相同则直接向该主机传输。
2. 路由器接收到数据帧后，网络层取得ip地址D，然后去路由表用D于各网络子网掩码做与运算，若与D的网络地址相同则直接交付，若没有则进行3。
3. 在路由表中查找是否有D连接的特定路由，实则使用其下一跳地址。否则进行4。
4. 用D与路由表中各网络的子网掩码相与，找到与其网络地址相同的那条，使用其对应的下一跳路由地址和接口。否则进入5
5. 使用默认路由进行转发，否则进入6。
6. 报告转发分组出错。

**构成超网**：(路由聚合) ，利用CIDR地址块查找目的网络，能表示原来传统分类的很多个路由，将小网构成大网。


**最长前缀匹配**：路由表中也相应的换成{网络前缀，下一跳地址}格式。而要用匹配前缀的方式寻找路由则可能会匹配多多个前缀，但应使用最长的那个相同前缀。
**网际控制报文协议ICMP**：属于ip层协议，**在ip数据报的数据部分**。分为差错报告类型和请求应答类型。
- 差错报告报文：这四种情况会引发ICMP发送差错报文：(1)、终点不可达，此时会向原主机发送差错报文。(2)、时间超过，数据帧超过生存时间触发。(3)、参数错误，路由器或目的主机收到数据报首部字段值错误时触发。(4)、改变路由：会把改变路由的报文发给原主机，数据报发给另外的路由器。
> 这几种情况不会发送差错报文：同属数据中对第一帧后续的帧都不发送ICMP差错报文。对具有多播地址和特殊地址(127.0.0.1，0.0.0.0)不发送。
- 询问报文：有回送请求和回答（用于测试本机和目的主机是否可达并了解其状态）、时间戳请求和回答（向目的主机或路由器请求其当前的从1900年1月1日起到当前时刻一共有多少秒，有32位的一个字段）。
- ICMP应用举例：ping，如windows上的ping命令就是直接运输层调用网络层的ICMP向目的主机测试连通性（会连续发送四个报文，给出的时间是往返时间，最后给出统计）。路径跟踪：unix上使用traceroute，windows使用tracert。它会列出到目标主机所经过的路由节点。

**路由器**：在访问不同网络时使用，路由中存放（目的网络地址，吓一跳地址），这个目的网络地址并非某一计算机的具体地址。<b class="green">路由器有自己的ip地址和物理地址</b>
- **路由器结构**：有一组输入端口（进入的分组在这里排队，如果分组处理的速度跟不上转发速度，这里的队列会很长，导致空间占满，**丢失帧**）、一组输出端口（使用的是一根总线结构，一个分组转出时占据全部总线）、路由选择部分、分组转发部分。
- **路由选择处理机**：路由器，路由选择部分的核心，<b c=b>负责构造、更新和维护路由表。</b>
- **静态路由**：网络管理员手工配置路由信息，网络拓扑结构或链路变化时需要管理员更改，静态路由信息默认情况下是私有的，不会传递给其他路由。适合简单网络环境。
- **动态路由**：路由器能自动建立路由表，并根据变化自行调整。
- **路由选择协议**：因为个网络访问的用户数量不同，且不同时间也不同，所以即使网络拓扑结构不变化也不能保证每次通信的时间一样。
- 路由聚合：就是构成超网，利用CIDR地址块查找目的网络，将小网构成大网。
- **路由协议分为两类**：
>**内部网关控议**：`IGP`(interior Gateway protocol)（，常用的有RIP,OSPF）。
    - **RIP**：(路由信息协议)，选择最短路由路径，即使其中有路由器是处于繁忙状态。所以RIP只**适合小型网络**内。
（1）这种协议的执行和其它一样是通过放到数据报中然后各路由读取处理来实现的。
（2）基于跳数来度量距离，向量表示为`<intel1,12>`类型，<b c=v>最大跳数是15,16表示不可达。</b>
    - **OSPF**：Open Shorts Path First！**内部网关协议**。是基于RIP的一些改进。RIP只和相邻的路由通信，而OSP是向这个**自治系统**的所有路由器都发送（初始和网络拓扑结构有变化时）。
    <b c=gn>    基于链路状态路由算法的协议</b>
>**外部网关协议**：`EGP`(External Gateway Protocol)（转发的分组到达自治系统边界时，该网络使用的控制协议，常用的有BGP）。
    - **BGP**：外部网关协议！支持CIDR。
（1）网络间通信选取路由需要考虑的东西更多，如安全性、政治，商业等相关的因素。
（2）所以外部网关协议不应该是选择最佳路由，而是应该选取一个比较好的的路由。
（3）每个网络需要设置一个BGP发言人，在发送信息时，会向附近的BGP发送要查找的目标，然后各BGP将可用的路径返回。

**三层交换机**：具有部分路由器功能的交换机，工作在OSI网络标准模型的第三层：网络层。三层交换机的最重要目的是加快大型局域网内部的数据交换，所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。

**IPV6**：ipv4的地址已经耗尽，现已无法再从ISP申请地址块，多数人使用的都是从移动、联通这些运营商已经从ISP申请到的ip。ipv6为提高更多的地址空间和协议控制，现在还处于草案阶段。
- **格式**：`AF36:0000:7328:0000:0000:3567:..:0096`#16进制表示（二进制总长128位），由8个段组成，每个段4位。
- 零压缩方式表示：某个段全零则用一个0表示（如`AF36:0:7328`），连续的几个段全0，则用：表示(如`7328::3576`)，某一个段前面几位为0则省略不写
- 特点：更大的地址空间（从v4的32位增大到128位）。灵活的首部格式（提供了更多可扩展首部，提高路由效率[路由器并不处理扩展的首部]）。支持资源预分配。允许协议继续扩充等。
- ipv4过度到ipv6：互联网中如此多的网络要想从ipv4过渡到ipv6逐渐的转变过来-即先让部分允许v4和v6同时使用。
>双协议栈：使用具有双协议栈的主机或路由，这样设备具有ipv4和ipv6两种地址，通过DNS解析目标主机使用的是哪种地址来决定使用哪种协议来封装报文。而作为接收时既可以辨别ipv4也可以解析ipv6。
>隧道技术：在ipv6网络进入到ipv4之前将ipv6报文封装成ipv4，离开ipv4网络后再将其解析出来交给ipv6协议解析。为了让同时支持ipv4和ipv6的主机识别这是一个ipv6报文需要在ipv4首部字段值设为41。伴随ipv6的还有ICMPV6同样比起ICMPv4多了更多的功能。



**虚拟专用网VPN**：局域网内多数主机只需要和内部电脑通信即可所以它们只需要一个能内部通信的ip地址即可，不需要一个全球唯一的ip。不过考虑到其可能需要与外部通信的时候，RFC1981年指明了一些专用的地址，这些地址可以内部任意分配。
NAT：网络地址转发。这里指的是NAT路由器。NAT中有一个全网ip，当内部主机要向外部通信时NAT会将其数据报中的原ip地址替换为该全网ip地址。
MPLS：多协议标记交换。能对分组做标记，在路由器中能根据该标记到路由转发表中可以提高以往的路由工作效率。原理：每个ip数据报在进入MPLS域（域中是许多支持MPLS的路由器）时被打上一个固定长度标记，被打上标记的在经过路由器时会在进入数据链路层后直接用硬件进行转发，所以速度快了很多。

## e、运输层：
该层主要有TCP和UDP协议，端口号的实现也在该层当中。该层还负责进行可靠传输。<b c=r>提供端到端的通信</b>
端口号：计算机之间的通信实际上是两个计算机进程之间的通信，运输层就是实现此功能，而如此多的进程需要分辨，且一个ip地址需要同时用于多个通信，所以使用端口号技术。
（1）服务器使用的端口号：系统端口号：`0~1023，IANA为HTTP,SMTP`等服务等分配的端口号。**登记端口号**：1024~49151，使用这类必须在IANA按照规定的手续登记，以防止重复。<b c=v>需要让全网都熟知这些服务，所以这些服务器程序使用额端口号必须是固定的且是熟知的。</b>
（2）客户端使用的端口号：49151~65535，仅在客户进程使用的端口号。<b c=r>每个进程必须有一个端口号，为了运输层能找到它们</b>。

**UDP**：**用户数据报协议**。UDP是一个较简单的协议。<b c=b>算上首部，最多65535字节(64K)</b>
（1）无连接的（发送数据之前不需要建立连接）。
（2）对交下来的报文添加自己的首部后就像下层传输，不会对数据进行额外操作，所以UDP并不提供可靠交付的功能。
（3）没有拥塞控制，这样网络出现拥塞时不会使源主机的发送速率降低，对于ip电话、视频这类服务需要数据稳定的则比较适合用UDP。
（4）可以是一对一，一对多、多对多的通信。
（5）首部格式：（只有8个字节）源端口、目的端口、长度、检验和。
- **端口类型**：熟知端口号、注册端口号、临时端口号。

**TCP**：**传输控制协议**。TCP协议较为复杂，大致特定有：
（1）面向连接的，在进行通信之前需要两个主机先建立连接，数据传输完毕后需要释放连接。
（2）TCP只能是点对点的。
（3）提供可靠交付服务，即会对数据进行差错检验、帧丢失恢复等操作。
（4）提供全双工通信。<b c=v>URG标记的报文段为紧急段，会优先发送</b>
（5）面向字节流，将应用程序交下来的数据全部看成是无结构的字节流处理。
- **TCP的连接**：TCP是点对点传输的，即两个端点，这个端点称为套接字（`套接字socket = (ip地址:端口号)`），所以一个tcp连接是由两个套接字确定的。两个主机间需要**发送3次报文来建立连接**，广为使用的称呼是3次握手，不过应该称之为一次握手中的3次报文传送。如下：
（1）`A-(SYN=1,seq=x)->B-(SYN=1,ACK=1,seq=y,ack=x+1)->A-(ACK=1,seq=x+1,ack=y+1)->B`。
（2）B发回确认后其实就可以建立连接，不过为了防止A第一次发送的报文出现滞留网络，
（3）而后B才收到就直接建立连接的情况（此时B以为建立了连接处于等待发送状态，但A是不知道的，浪费了网络资源）
（4）所以B应该等到第二个信息无误后才建立连接。
- TCP连接释放：
（1）释放过程：`A-(FIN=1,seq=u)->B-(ACK=1,seq=v,ack=u+1)->A`#A会先向B发送FIN=1的释放报文，然后A释放连接，此时A处于半关闭状态（`A能接受B的数据`，但不能再发送）
（2）然后B收到后发出确认关闭报文，B再释放链接，A收到后彻底进入关闭状态。

- **tcp首部字段**：<b c=v>TCP首部占20字节</b><b c=r>一个TCP报文段数据部分最多为`65495`字节。</b>
（1）源端口和目的端口：与UDP的分用相似，tcp的分用通过端口实现。
（2）序号：因为TCP是面向字节流的，会为数据中的每一个字节编号，范围[0,2^32-1]，在建立连接时编号，编号用完又从0开始。
（3）确认号：4字节，希望收到的下一个报文段的第一个字节的序号。
（4）数据偏移：分组中数据起始部分距离报文首部起始部分的距离，也是首部最大长度。
（5）紧急URG：为1时表示该分组数据中含有重要数据，需要优先发送。
（6）确认ACK：ACK为1时才有效，建立连接后的ACK都为1。
（7）推送PSH：希望在键入一个命令后能够立即受到对方的响应，可让PSH置1，这样对方受到后会将该分组数据前推给进程使用，而不要等到缓存填满再给进程处理。
（8）RST复位：为1时表示需要TCP连接中出现严重差错，需要释放连接，建立新的连接。
（9）同步SYN：建立连接时用于同步序号，SYN=1,ACK=0表示这是一个连接请求报文段。
（10）终止FIN：用于释放连接，为1时表示发送完毕。
（11）保留：占6位，用于以后的扩展。
（12）窗口：发送报文段一方的接收窗口（范围）。<b c=v>窗口大小是等待一个确认时，能传输数据量的大小</b>
（13）检验和。（14）紧急指针：URG=1时才有效，指出分组中紧急数据的起始位置。（15）选项。
- **使用的四种计时器**：重传计时器、坚持计时器、保持计时器、时间等待计时器。
- **超时重传**：tcp的超时的时间选择不是那么容易的，目前使用的超时时间选择是一种自适应的算法，即根据该传输报文已有的传输时间记录计算一个加权平滑后的时间，设置一个略大于该平滑时间的值作为超时时间，若发生了重传则将超时时间设得更大一些（一般取之前的超时时长的2倍），不在发生重传后恢复之前的平滑计算方法。
- SACK字段：在首部选项中添加SACK字段表示接收重传缺失序列，接收端将缺失的序列的起始与结束部分告诉发送端。
- **流量控制**：因为若接收方速度太慢赶不及处理来自发送方的数据（如处理过慢导致缓存占满，导致后续的分组丢失），<b c=v>所以tcp通过控制窗口的大小来控制发送方后续发送数据范围</b>。
（1）如：B将窗口调为0-500，A发到300后，B处理变慢，将窗口调到400，A就只能再发到400，B处理完后再向后调节。
（2）<b c=b>每个窗口的数据都有序号，接收方需要之前接收帧的序号，来决定下面要接收多少序号开头的帧。</b>
- 传输效率：当传送的数据很少，甚至比协议首部还短时这种传输是有点浪费网络资源的，TCP使用Nagle算法来缓解这一情况：将要发送的数据逐一添加到缓存中，并先发送第一个字节，若收到对方发回的对第一个字节的确认，则将后续的数据都加入缓存，缓存满后将其作为一个段发送出去。这样对于数据比较少的通信就使用了**捎带的方式**。

**TCP拥塞控制**：控制方法中只有一些避免的方法和尝试修复的方法，而没有具体检测解决的方法，常用措施如下：
- **慢开始**：TCP在开始传输时先以一个小的窗口发送数据（一般窗口[cwnd]从1开始），若未出现拥塞则每次调大窗口，若出现拥塞则适当减小窗口。（根据是否超时来猜测是否发生拥塞）。
>（1）窗口cwnd=1（1kB），收到对方的`T个`（这里只有1个）确认后，这为一个轮次。
>（2）将cwnd+=T，`发送cwnd个报文段`，若收到对方的`T个`确认。这为第二个轮次。
>（3）cwnd+=T，再发cwnd个送报文端，依次循环。<b c=r>现在网络中一般不用全部确认完再发送其它数据，而是收到一个确认就立即发送</b>
>（4）每个轮次使用的时间称为1个`RTT`时间，当然每个RTT不一样大。图示例如下
![拥塞控制](_v_images/664243161043.png =463x)                                                                                ![多种拥塞控制法变化](_v_images/1330217189469.png =521x)
- 拥塞避免：（称加法增大）将cwnd开始置的很小，然后每次只加1，比慢开始那样倍增慢很多。
- 快重传：让接收方即使接受到失序帧也确认，若某帧丢失，则接收方重复确认上一帧。接收方收到连续3次同帧的重复后才会重传对应帧，否则一直顺序发送其它帧。
- 快恢复：（也叫乘法减小）配合其它方法使用的。将慢开始门限值`ssthresh设为cwnd/2`，再设置cwnd=ssthresh。

拥塞控制的使用时机：实际网络中并非只使用某一方法，而是情况变化时使用相应方法。如右图
（1）防止拥塞窗口一直增大而导致网络拥塞，需设置一个**慢开始门限**（ssthresh）
（2）当`cwnd<ssthresh`时使用慢开始算法。当`cwnd>ssthresh`时用拥塞避免算法。相等时可随意。（ssthresh一般是最大窗口的一半）
（3）右图点4是帧丢失，这会导致接收方连续收到上一帧的确认，而又转为慢开始，所以**这里即可使用快重传，也可使用快恢复**。

主动队列管理AQM：Active Queue Management，路由器的处理队列如果排满的话后面的分组都会被丢失，如果这其中包含了许多TCP的分组那么就又会引起重传，照成更多阻塞。所以1998年提出AQM，在队列中设置一个警惕值，到达该值时就丢弃一些分组，让它们减缓速率，而丢弃的方法有许多，早期的RED随机丢弃算法（已被弃用）。

**吞吐量**：受上面拥塞控制、流量控制等的影响，当前计算机数据传输率就是该台计算机网络的数据`吞吐量=一个窗口的数据/到下次发送的时间间隔`。

## f、应用层：
以上几层讨论了计算机之间的通信，但如何将信息交给计算机的程序则是在应用层发生。
**DNS域名系统**：<b c=gn>由DNS协议控制</b>。用于将解析为对应的ip地址供网络传输使用。每个域名对应一个套接字，这些数据存储在DNS服务器上，因为数量较多所以使用的分布式存储，解析域名时本机会向附近的DNS服务器请求，获取域名对应的ip地址，然后才能进行用户的通信操作。
**域名结构**：为了便于管理和域名服务器查找各域名，域名被设置为分级结构，如：acc.kv.com中以点做分割，com为顶级域名，kv为com下的一级域名，acc为kv下的二级域名（子域名就是这么构成的）。以此可以写成一颗树的形式，便于服务器快速查找，以区的形式来划分给各域名服务器(如**kv下的所有域为一个区**)。常见的通用顶级域名有：com(公司企业)、net（网络服务机构），org（非盈利组织），int（国际组织），gov（美国政府），mil（美国军事），cn（中国）等等。
**域名服务器**：全球范围都有部署域名服务器，不过这些域名服务器的位置都是保密的。
- 本地域名服务器：一般一个机构或组织可以自己准备一个本地域名服务器，上面存储一些常用的域名地址，主机发起域名解析请求时会先向本地域名服务器发送。
- 根域名服务器：最顶级的域名服务器，如果一个其他域名服务器无法解析时就会求助于根域名服务器。
- 顶级域名服务器：负责该根域名下的所有二级域名。
- 权限域名服务器：负责一个区的域名服务器（这个区指上面说的区），若该权限服务器未能查到对应域名会告知用户端下一次使用哪个权限域名服务器查找。

**FTP**：File Transfer Protocol（**文件传输协议**）迄今使用最广泛的文件传输协议。
（1）运输层走tcp，是一种交互式的使用文件副本的传输方式。
（2）原理：由于各计算机生产商研制的文件系统都有差异（如存储数据格式不同、控制方法不同等），导致兼容这些各种文件系统不容易，
（3）服务端的ftp有一个主进程（打开熟知端口，让客户机能连接的上，等待客户进程发出连接请求等）和若干附属进程（如控制进程和数据传输进程）。
（4）主进程与从属进程并行处理。控制连接在整个会话期间一直打开。
（5）一台计算机从ftp服务器下载文件时，ftp对文件会进行封装：数据、数据段、数据包、数据帧、比特。

**TELNET**：**远程终端协议**。
（1）本地运行TELNET客户进程，远程运行TELENET服务进程，网络层使用TCP建立连接，将对方的屏幕图像投放到本机上，
（2）由于各操作系统的差异，TELNET中使用网络虚拟终端NVT（network virtual network）定义命令和数据以怎样的方式通过互联网。
（3）服务器软件把收到的数据命令从NVT格式转为所需要的格式。
**万维网www**：world wide web，大规模联机式的信息储藏所，
（1）一个分布式的超媒体系统（超文本的扩展，包含其它文档链接的文本），也就是如今浏览器中的网页。
（2）里面有丰富的数据形式，且可以通过一个简单的链接跳到其它页面。
（3）服务端与客户端应用层使用http协议来传输这些数据，使用HTML语言让各人可以定制想要的样式。使用统一资源定位符URL来标志万维网上的文档。
**URL**：统一资源定位符，用来表示互联网上资源的位置和访问这些资源的方法。
（1）url形式为：`<协议>://<主机>:<端口>/<路径>`#浏览器中都会默认加上`http://www.`#使用http协议时不加端口号的话默认为80。
**HTTP**：超文本传输协议（Hyper Text Transfer Protocol），
（1）http是面向事务（一系列的信息交换）的应用层协议，规定了浏览器怎样与服务器传输数据。
（2）http协议本身是**无连接**的，网络层使用TCP协议来建立连接，所以http不用再进行数据差错的检测，
（3）http是**无状态**的，同一个客户第二次访问同一个服务器上的页面，服务器的响应与第一次是一样的。
- **http1.0**：<b c=r>http的报文会放在tcp建立连接的第三次发送报文的数据中，建立了tcp连接后也就建立了http连接，服务端直接发送所需的数据给客户端。</b>
<i c=gn>1.0版本的缺点是如果一个文档上出现多个链接（如来自于其它同服务器地址的图片）会需要多次建立tcp连接来请求。</i>
- 1.1版本：使用持续连接克服了这个问题，服务器发送一次响应后依然会保持这个链接，
只要那些链接资源在同一个服务器上就不会再次建立新的连接。不过分为：
>**流水线方式**（前一个请求未响应就能发送下一个请求，适合较大的万维网资源）
>**非流水线方式**（客户收到一个响应后才能发送另一个请求），所以如果是请求不频繁的情况流水线方式会占用网络资源。协议报文格式如下：（左为请求报文，右为响应报文）
![http](_v_images/20210105200337974_18748.png =609x)                                                        ![pop3AndIMAP](_v_images/20210108103610621_25387.png =552x)
- 开始行：用来区分是请求报文还是响应报文。
- 首部行：用来说明浏览器、服务器或报文主体的一些信息。
- 方法：对所请求的对象的一些操作。OPTION：请求一些选项的信息。GET：请求读取有url所标志的信息。HEAD：请求url所标志的首部。POST：给服务器添加信息。PUT：在指明的url下存储一个文档。DELETE：删除指明的url所标记的资源。TRACE：用来进行环回测试的报文。CONNECT：用于代理服务器。当然还有一些其它的方法。
- http状态码：200 OK 正常返回信息。201 Created 请求成功并且服务器创建了新的资源。202 Accepted 服务器已接受请求，但尚未处理。301 Moved Permanently 请求的网页已永久移动到新位置。302 Found 临时性重定向。303 See Other 临时性重定向，且总是使用 GET 请求新的 URI。304 Not Modified 自从上次请求后，请求的网页未修改过。
400 Bad Request 服务器无法理解请求的格式，客户端不应当尝试再次使用相同的内容发起请求。401 Unauthorized 请求未授权。403 Forbidden 禁止访问。404 Not Found 找不到如何与 URI 相匹配的资源。`500` Internal Server Error 最常见的服务器端错误。`503`Service Unavailable 服务器端暂时无法处理请求（可能是过载或维护）。
- **cookie**：因为http是无状态的，而一些厂商又希望记录用户在网站上的一些浏览记录（未登录情况下），所以在http首部设立了一个cookie，首次向服务器请求时服务端会为起生成一个唯一标识符，响应报文中会添加一个set-cookie首部行，客户端收到后浏览器获取Set-cookie值，存于本地，然后在下次发起请求时会添加设个set-Cookie首部。用户在几天后再次访问该网站也会加上该cookie值。cookie是一个很小的文本不用担心它会传播病毒，获取用户磁盘信息等安全问题。<b c=v>当然服务端可以设置是否使用cookie。</b>

**代理服务器**：又称为万维网高速缓存。可工作在客户端、服务端或两者中间的一个网络实体，当使用了代理服务器后访问从以前的客户端直接访问服务器变为：客户端先访问代理，代理先查看本地是否已经存在访问的对象，若存在则把该数据放到报文中返回给浏览器（能减少很多同学量），若不存在则代替浏览器向服务端发送请求（会更换源ip），服务端将资源发送给代理，代理再发送给浏览器。
**万维网文档**：
- HTML：万维网的文档，使用超文本标记语言HTML制作，其规则有w3c，即www制定。
- XML：Extensible Markup Language，可扩展标记语言是HTML的扩充，HTML是显示数据，而XML是传输数据，用于标记数据类型，使得集成来自不同类型的数据成为可能。
- XHTML：是HTML5标准的一部分，所以逐渐被称为H5，与html几乎一样，但规格更严谨，逐渐代替html。
- 动态文档：浏览器访问服务器时才由应用程序动态创建文档，输出http格式的文档给浏览器，如天气、股市行情应用，相当于由服务器实时动态生成文档，所以需要一个应用程序来实时生成这个文档，这个程序称之为CGI程序（也就是那些后台程序）。
- 活动万维网文档：在客户端实现一个小程序能够负责用户交互，实时发送请求改变数据的效果。也即现在的javascript。

**万维网信息检索系统**：万维网是一个大型的联机式的信息储藏所，所以如果可以使用一个搜索程序来让用户可以搜索这些资源的话那对将会是一个非常有意义的事。**搜索引擎**（分为全文检索搜索引擎和分类目录搜索引擎）就是这么一个程序。它使用爬虫程序从网上爬取各万维网文档内容及其内部的链接的文档内容，整理成易搜索使用的数据结构存储下来，当用户搜索时使用中文分词算法，搜索算法来从已经存储好的数据中搜索匹配度高的，然后使用pageRank之类的排序算法将各文档的相关内容，连接罗列出来。其它还有垂直搜索引擎（在一个特定的领域上或根据用户的爱好信息之类的匹配来搜索）和元搜索引擎（在多个搜索引擎上搜索，然后集中处理）。<i c=gy>博客、微博(微型博客)、社交网站是文档来源较多的地方。</i>

**电子邮件**：这种应用在应用层使用的并不是http协议。由3部分组成：用户代理（运行在客户端的一个程序）、邮件服务器、邮件发送协议（SMTP）和邮件读取协议（如pop3）。邮件地址使用格式：用户名@邮件服务器域名。
- SMTP：simple mail transfer protocol。smtp客户进程发送邮件，smtp服务进程接收邮件，连着之间使用tcp建立连接。
（1）smtp不使用中间邮件服务器，接收邮件的服务器出现故障时，发送方只能等待一段时间再次尝试与其连接。
（2）可使用RCPT发送给多个收件人。连接释放：SMTP客户端发送quit命令，服务端返回221表示服务关闭。
（3）缺点：传送的是明文，不利于保密、FROM命令后地址可任意填写，所以会导致很多垃圾邮件，smtp传送的ascii码而不是二进制。
- ESMTP：08年10月颁布的。在smtp上增加的一些安全功能：客户端的鉴别、服务端接收二进制报文、服务端接收分块的大报文、发送前先检查报文大小，使用安全传送TLS。
- **POP3**：邮局协议pop的第三个版本，是一个较常用的客服**服务端**工作方式的邮件**读取协议**。
（1）pop3邮件服务器只有在用户输入鉴别信息后才能读取，读取后会被立刻删除，由于部分情景不方便，所以后面有增设删除时间。
（2）报文存取协议，客户服务端方式工作。
（3）根据收件人地址交给ISP邮件服务器【脱机状态运行】
（4）邮件处理都在用户计算机进行，之后OPP3不再保留这些邮件
（5）是一个具有存储转发功能的中间服务器。
- **IMAP**：Internet message access protocol。网际报文**存取协议**，也是一个客户服务端工作方式但比pop3复杂的邮件读取协议。
（1）报文存取协议，客户服务端方式工作。
（2）所收到的邮件先送到IMAP服务器【联机状态运行】
（3）用户计算机上运行IMAP客户程序，与IMAP服务端直接用TCP连接，访问。
- 基于万维网的电子邮件：由于以前的方式需要在计算机上安装代理软件UA及不方便，20世纪90年代中期推出了基于万维网的电子邮件服务，浏览器使用的始终是http协议，所以浏览器和邮件服务器之间使用的依然是http协议，邮件服务器间传送时使用的依然是smtp。
- MIME：通用互联网邮件扩充，由于smtp的一些局限（如：限于传送7位ascii码，许多国家文字无法传送回车换行等问题），使用的mime是对smtp的一个扩充，增加了邮件主体结构，定义了传送非ascii的规则等东西。

**DHCP**：（Dynamic Host Configuration Protocol）**动态主机配置协议**。由于计算机会随时断网连网，如果使用手工配置会及不方便，所以DHCP提供即插即用连网的让计算机获取ip的方法。**运输层使用UDP**。
- 工作过程：DHCP采用客户服务端的方式，想要获取ip的主机A向DHCP发送发现广播，由于不知道DHCP的地址且自己无ip地址，所以在发送的报文中将原地址置为全0（0.0.0.0），目的ip置为全1（255.255.255.255）,封装为数据报发送到网络上，但只有DHCP服务器收到后才会回应，会现在DHCP数据库中查找目标计算机配置信息，若有则返回找到的信息，若找不到则从服务器ip地址池取一个ip分配给该计算机，并本地数据库中记录。如果每个网络都放置一个DHCP服务器则会导致DHCP服务器过多，所以使用DHCP中继代理（一般是个路由器），当这个代理收到A发送的发现报文后，中继代理会向DHCP服务器单播发送此报文，收到DHCP返回的报文后又转发给A。DHCP还会为该ip分配一个租赁期限，长短有DHCP控制。

SNMP：简单网络管理协议，各网络可以成立自己的网络管理站，安排网络管理员管理各处的设备。snmp是按照客户服务端的方式工作的，snmp服务器不停的监视来自snmp客户端的请求。snmp可实现统计、配置和测试功能，网络故障时snmp可以差错检测和恢复功能。组成：snmp由snmp本身、管理信息结果SMI、管理信息库MIB。
p2p应用：一种下载时从其它下载用户哪里获取同一下载任务中部分数据的手段，即部分数据从其它下载用户获取，部分从服务器下载，最后拼接，这比普通从服务器下载要快。

## g、网络安全：
威胁：分为两类，被动攻击（数据报文被截获），主动攻击（篡改、恶意程序、拒绝服务【Denial of Service，Dos】，分布式的拒绝服务攻击为Distribute Dos。等），被动攻击难以检测，所以使用数据加密技术防范。对于主动攻击则使用加密与鉴别技术相结合。所以一个安全的计算机网络应该有以下特征：保密性（数据加密）、端点鉴别（对来访进行身份鉴别）、信息的完整性（就算有了数据加密和端点鉴别也不能保证数据被篡改或删除部分）、运行的安全性（对付类似DDos这类攻击，即使没有窃取任何数据也使得计算机无法运行）。
**鉴别**：鉴别是指要确认通信的对方是自己要通信的对象。授权则是指所进行的过程是否被允许。鉴别可分为报文鉴别与实体鉴别（鉴别发送报文的实体是人或进程）。
1. **报文鉴别**：数字签名虽然也能购实现报文鉴别，但对较长的报文进行加密会消耗很多计算时间，所以需要使用另一简单方法进行报文鉴别，即**密码散列函数**<i c=gy>（输入可以很长，但输出较短且长度固定，经过散列函数得出的值称为散列值，同一个散列值可以对应多个不同输入，但密码散列函数要对不同报文得到同一散列值是计算上不可行的）</i>，<b c=gn>多数协议中首部的检验和就是散列函数中的一种，不过检验和用于发现传输过程中的bit差错。</b>
>**MD5**：Message Digest 第5个版本，91年出现的一个较常用的密码散列函数，当时作者声称要找到另一个相同的明文的MD5散列报文几乎不可能。但在04年中国王小云称可以系统的找到一对不同的明文的MD5散列与其一致，且不需要1h。
>**算法原理**：（1）填充：如果输入信息的长度(bit)对512求余的结果不等于448，就需要填充使得对512求余的结果等于448。填充的方法是填充一个1和n个0。填充完后，信息的长度就为`N*512+448(bit)`（2）记录信息长度：用64位来存储填充前信息长度。这64位加在第一步结果的后面，这样信息长度就变为`N*512+448+64=(N+1)*512`位。（3）装入标准的幻数（四个整数）：标准的幻数（物理顺序）是（A=(01234567)16，B=(89ABCDEF)16，C=(FEDCBA98)16，D=(76543210)16）。（4）四轮循环运算：把填充后的数据按512长度分块，每一个512位的数据块再按128分为4份，各份送到不同的散列函数计算。[MD5学习地址](https://blog.csdn.net/u012611878/article/details/54000607)
>SHA-1：1是指SHA的第1个版本，是MD5上的改进，比MD5更安全，但计算速度比其缓慢。当然SHA也没有达到期望的安全高度，也已经被攻破。
>报文鉴别码：散列函数简单的使用就是将散列值H与明文x拼接，接收方收到后分割得到H与x，计算x的散列值与H比对，若两者一致则认为是对方发送的，不过由于这个明文x和散列H可能都被替换，所以一个解决方法是：对H进行公钥加密（加密后的值即为报文鉴别码MAC），接收方再用私钥进行解密，然后得到H。
2. **实体鉴别**：报文鉴别是对每次发送的报文都鉴别对方身份，而实体鉴别是系统接入的全部时间内对和自己通信的实体只进行一次鉴别。最简单的实体鉴别：a将带有自己身份信息的报文通过对称加密算法加密后发给b，b用私钥解密得到a的身份信息。这个过程中c可以截获这个加密后的报文，然后无需解密，直接自己发给b，那么b无法分辨c。这种攻击称之为**重放攻击**，应对重放攻击的方法是使用不重数：a将自己的身份信息a1和自己的一个不重数a2，发给b，b将自己的一个不重数b1和加密后的a2》Sa2一起发给a，a再将b1加密得Sb发给b。因为不重数不能重复使用，所以c即使截获了也不能使用这些值。若是使用非对称加密，且互相传输公钥则有以下攻击（**中间人攻击**）：因此在密钥分配上也有相关算法。
![zjr](_v_images/20210110155821789_1040.png =573x)

**网络层安全协议**：使用ESP或AH协议的ip数据报称为ip安全数据报（IPSec数据报），两种工作方式：运输方式（运输层报文段前后添加若干控制，再加上ip首部）、隧道方式（原始ip数据报前后添加控制信息，再加上新的ip首部）。
- 安全关联：SA(Security Association)源实体和目标实体之间创建一条网络层逻辑连接，这样就能提供安全服务。
- 示例：公司总部主机H1与分公司主机H2通信，H1发送的ip数据报需要先经过总部的路由器R1的IPsec加密处理，然后由分公司路由器R2对安全数据报解密，再传送到H2。当然公司内部主机通信和主机请求外部天气预报之类的不用通过路由加密。<b c=b>IPSec能够加密数据、含有不重复序号能防止重放攻击、R2能检查数据完整性。</b>
- 其它构件：发送安全ip数据报的实体可能需要用到多条安全关联SA（指定使用什么加密算法，密钥等），这些SA放在安全关联数据库SAD，发送方和接收方都要查找其中的SA。并不是所有的数据报都需要加密，所以还需要一个安全策略数据库SPD来指明什么数据用IPSec处理。

**运输层安全协议**：万维网上进行交易服务时也需要能够确保安全，之前有一个安全电子交易SET协议，但由于要安装独立的软件而很少有使用。
- SSL与TLS：安全套接字层SSL作用在HTTP与运输层之间，为通过TCP的数据做提供安全保障。TLS是为了对SSL标准化，在3.0上做的改进，为基于TCP的网络应用提供安全数据传输。两者在使用上相差不大，**这用SSL代替SSL/TLS**，加上SSL后结构为：TCP层、TCP套接字、SSL子层、SSL套接字、应用层。这里SSL套接字与TCP套接字类似，是提供应用编程接口API。若浏览器使用SSL的话HTTP会调起SSL，对整个网页进行加密，http变为https（s表示security），https端口号是443，发送方将数据记过SSL层加密后给TCP，接收方SSL层从TCP获取数据后再解密交给应用层。**SSL不仅限于http使用**。
- 作用：服务器鉴别（用户证实服务器身份）、客户鉴别（允许服务器鉴别客户身份）、加密SSL会话。
- 万维网使用示例：（1）协商加密：浏览器A向服务器B发送SSL版本和可选的加密算法，B选定一个加密算法，然后告知A。（2）服务器鉴别：类似数字签名那一套。（3）会话密钥计算。（4）安全数据传输。

**应用层安全协议**：PGP（Pretty Good Privacy）是一个完整的电子软件安全包，是一系列加密算法的组合使用。
防火墙：一种特殊编程路由器，安装在一个网点和网络其余部分之间。一种访问控制技术，控制网络访问边界的分组，禁止不必要的通信，降低风险。分为两类：分组过滤路由器（对通过的分组进行过滤，如根据原ip地址，使用的协议、端口号等。如USERNET新闻网端口号119，公司路由防火墙中禁用掉它，这样员工上班时间不能看这个新闻网。）、应用网关（代理服务器，所有进出网络的应用程序都必须经过网关，实现基于应用层数据的过滤和用户鉴别）
入侵检测系统：IDS，第二道防线，能检测端口扫描、网络映射、DDOS等很多网络攻击，不过由于误报率也很高，所以IDS一般不执行阻断。
未来发展：椭圆曲线密码（下一代金融系统使用的加密系统）、移动安全、量子密码（量子计算机的发展会使得很多加密算法无效）。
## h、互联网上的音视频：
使用电路传输多媒体信息本是一项很成熟的技术，但是电话网的价格太高，因此需要使用互联网。但由于多媒体数据往往较大，<b c=gn>所以会使用各种对应的压缩技术，然后传输，接收端解压后再使用（所以一些游戏下载完后会看到一个解压过程）。</b>甚至为此使用专门的媒体服务器（与普通服务器有区别）。
**播放时延**：音视频等一般较大，如果等到下载解压后再播放会很影响用户体验，所以边下载边播放是必要的。不过由于互联网的拥塞可能会造成下载播放过程中常停顿的问题，因此需在下载一部分数据后再开始播放，这也叫**缓存**，又因为传输过来的每两帧数据间的间隔不一样（拥塞造成的每一帧传输经过的时间不一样），所以接收端需要按照各分组的序号将它们排好序加入到缓存中 ，达到固定缓存队列大小**耗费时间T**，再按照间隔从缓存队列中拿出播放，这个T就是播放时延。
互联网音视频服务3种类型：
1. 流失存储音频/视频：将已经录制好的音频/视频文件存放在服务器上，用户通过互联网下载，可以实现边下载边播放。下载并非是下载到磁盘。
2. 流式实况音频/视频：一对多的传输，使用ip多播，形式上类似广播。为边录制边发送模式。
3. 交互式音频/视频：用户使用互联网和其他人进行实时交互式通信，互联网电话和互联网电视会议是这种类型。

**媒体服务器**：传统的做法是将多媒体文件放在万维网服务器上，浏览器中的播放器指定url地址，实际是使用HTTP+TCP请求资源，然后客户端可以边下载，边解压，边播放。而媒体播放器是专门为流式音视频文件而设计的（可与万维网服务器在同一个端上运行）。当浏览器中的播放器url使用的是媒体服务器上的地址时传输过程与万维网服务器过程类似，不过可选用是否使用使用UDP的协议传输（如RTP），当然使用UDP的协议有如下缺点：
媒体UDP传输缺点：（1）若传输速率低于所需的播放速度会出现暂停情况。（2）很多单位**防火墙会阻拦UDP分组进入**。（3）若是UDP，还需要使用RTP等协议才能实现暂停，播放等控制。所以YouTube等网站使用的TCP连接传输媒体。
**RTSP**：实时流失协议（Real-Time Streming Protocol）客户服务器工作方式，RTSP本身不传输数据，只是给多媒体数据添加控制操作，提供用户控制操作。浏览器用HTTP用GET向万维网服务器获取到的媒体**元文件**<i c=gy>（非音视频文件，而是一种很小的文件，描述音视频文件信息的文件）</i>发送给浏览器内的媒体播放器，媒体播放器的RTSP客户端发送SETUP报文给RTSP服务器建立连接。
**ip电话**：20世纪70年代就已经提出的概念，不过当时互联网的很多限制，并未发展起来，90年代中期VocalTec提出ip电话网关（公用电话网与ip网络接口设备），通信解构就变成了：电话->公用电话网->ip电话网关->互联网->pc主机/ip电话网关->公用电话网->电话。不过仍有很多问题存在。
RTP：实时运输协议，应用层协议。实时提供端到端的运输，但不提供任何质量服务，运输层使用UDP。
RTCP：实时运输控制协议，与RTP配合使用，也是RTP不可分的一部分，主要作用为服务质量的监视与反馈、媒体间的同步。
IntServ：**综合服务**。可供单个应用会话提供服务质量的保证。定义的两类服务：（1）有保证的服务：保证一个分组在经过路由器时时延有一个严格的上限。（2）受控负载的服务：使应用程序比通常及最大努力更有保证的服务。
>组成：资源预留协议RSVP、接纳控制（决定是否同意对某一资源的请求）、分类器（把进入路由器的分组进行分类，把不同类别的分组放入特定队列）、调度器（根据服务质量要求决定分组发放的顺序）。

DiffServ：**区分服务**，由于综合服务和资源预留协议都比较复杂，很难在大规模网络中实现，所以DiffServ力图不改变网络结构。
## i、无线网络和移动网络：
:::alert-info
20世纪80年代末，移动通信技术进入高速发展时期。由于之前的电缆连网很不方便，且费用较高。所以无线局域网的发展是迫切的，现在无线局域网连如互联网成为最常用的上网方式。便携站：便于移动，但工作时位置固定不变。移动站：可在移动过程中进行通信。
:::
**无线局域网**：WLAN（wireless local area network），可分为有固定基础设施和无固定基础设施两类。WIFI（wireless fidelity，无线保真度）已经成为无线局域网代名词（但实际上没多大关系）。
- 有固定基础设施类：最小构件是BSS（basic serve set）包括一个基站和若干个移动站。接入点AP是基本服务集内的基站，网络管理员安装AP时必须为该AP分配一个标识符SSID，BSS覆盖的一个范围<b c=v>（向周围发送电磁波，即电磁波作为无线网传输数据）</b>为服务区BSA，结构如下：
![bss](_v_images/20210120101713240_6428.png =610x)
移动设备向AP发送DHCP获取ip，自动成为该AP子网下的一台主机。<i c=gy>如今电脑上几乎都已经安装了无线局域网适配器可直连wifi，而不需要安装无线局域网网卡。之前使用WEP方案对wifi加密（连接wifi需要输入密码），之后改为加密性更好的wpa。</i>
- 移动自组网络：无固定基础设施的无线局域网，又称自组网，通过一台设备连接另一台设备的串联使用。这种自组网络使用广，使用也比较方便，不过在路由选择协议、ip多播、网络安全上均存有较大问题。

**无线个人区域网**：WPAN(wireless personal area network)，把自己的个人设备在自己周围用无线技术连接起来，组成自组网。它与个人区域网PAN（可以是有线连接）不完全相同。wpan与wlan不一样。分为低速WPAN、高速WPAN。
- 蓝牙系统：最早的WPAN，使用TDM和跳频扩频FHSS技术，组成不用基站的皮可网。数据率为720kbit/s，范围为10m。

蜂窝移动通信：移动通信种类很多，如蜂窝移动通信、卫星移动通信、集群移动通信、无绳电话通信等。 wifi范围较小，蜂窝通信（一个网络分为几个小区，一个小区设置一个基站）则覆盖广泛。

## s、网站搭建：
购买服务器:(建一个普通个人网站的话1vcpu,2G运行内存就够了,可以适当再进行升配,[vcpu指虚拟cpu])。
购买域名：购买后在购买商解析域名到对应ip地址
远程连接服务器：(若连接中出现黑屏问题可以先停止服务器再在配置中更换系统镜像,试试[先手建议使用windows 2018 企业版])。[远程连接失败],若远程连接失败可以尝试在阿里云ECS管理>安全组规则>快速创建规则,常用端口选择RDP(3389),自定义端口为3389/3389,(远程桌面默认使用3389端口)。
下载tomcate和jdk：进入下载页面下载tomcate(exe文件和tomcate zip文件都需要下载[jdk也下载对应的exe文件和zip文件,8.5.4左右版本的tomcate需要1.7以上的jdk版本])注意与自己的系统对应。tomcate程序的安装需要jdk，所以先安装jdk，安装好后配置其环境变量；然后tomcate安装位置安装到jdk安装路径中的jre文件夹下(安装过程中会出现一个选择端口号,密码的界面,端口号选择8080)，全都安装好后在在浏览器输入：http://localhost:8080
(若无页面出现请在tomcate文件夹下的bin文件夹下点击startup.bat运行tomcate服务)
经验：(备过案的域名才能被解析)
**分为两种情况建站**：1、自己的服务器是处于外网的情况下(少数情况);2、自己的服务器是处于内网的情况。处于外网的情况比较好解决只需要配置一下tomcat即可。处于内网的情况会复杂一些，因为别人在浏览器中输入的公网ip(或对应域名)，需要让其映射到内网ip上实现访问。先配置tomcat，安装好tomcat并启动服务后在浏览器输入http://localhost:8080会进入到tomcat的一个默认页(只要是输入8080端口就是进webapps下的ROOT文件中的index文件,无论你是否在server.xml文件中配置了Context的docBase属性路径)。修改server.xml文件：
<Connecter connectionTimeout="20000" port="8080" protocol="HTTP/1.1" redirrectPort="8443"/>这个标签中端口使用8080,不要改为80(表示输入localhost时不需要加端口号就能访问),因为改为80后本地无法访问(!),<Engine defaultHost="wcs.net" name='Catalina'>这个标签中将defaultHost改为自己映射的域名,<Host>标签中将name也改为这个域名,可以在Host标签中加<Context path='index' docBase="C:\..."/>docBase路径一定要为绝对路径且是到webapps目录下,不然tomcat会启动失败。所以不配置<Context/>标签也行，我们将html文件就放到ROOT下首页以index为名。然后借助nat123软件做端口映射：nat123官网下载好软件进入首页底部点击添加映射选择HTTP80(要钱),如果是在服务器上也装nat123内网地址就写localhost,内网端口号与tomcat中所填的对应写8080,写上外网域名(公网ip对应域名,与tomcat中所写的一致),外网端口不用填写会自行分配,点击保存，如果映射显示成功且本地输入localhost:8080也能打开网页的话一般外网就能访问了。其它电脑中直接输入域名(不用加端口号)就能访问得到了。
(apache和tomcat是两个不同的东西，apache用于部署后台，tomcat用于部署前端网站)
[后台配置到服务器]前端的部署使用tomcat，后台的部署使用apache，这是一整套，下载好apache后(下载httpd开头那个文件，注意下载的位数要与python的位数一致，而且处理器也要相同，x64和x86，不然配置中导入路径中文件时会报错)解压进入目录，按下面的链接中的教程修改httpd.conf文件配置，在240行左右第一个<Directory>标签中要添加一个参数。
将Index.html文件放到htdocs文件夹下，默认访问的是该页面，所以用apache配置网站也可行。
配置教程：https://blog.csdn.net/ezreal_tao/article/details/82218728
mod_wsgi.io文件找不到的问题：https://blog.csdn.net/chao_8023/article/details/74012324
**apache常用命令**：
安装指定服务(bin文件夹下使用)：httpd -k install -n 服务名称
卸载服务：sc delete 服务名称
启动服务：httpd start
启动指定服务：httpd -k start -n 服务名
停止指定服务：httpd -k stop -n 服务名
重启服务：httpd restart
停止服务：httpd -k shutdwn
tomcat下载安装： https://jingyan.baidu.com/article/4b52d702a5eaa0fc5d774b72.html
apache下载安装：https://www.jianshu.com/p/cd916b8b31a8
解决外网访问问题：https://blog.csdn.net/xin_118/article/details/79956559
[jdk的安装。](https://www.jianshu.com/p/467c29949beb)
jdk下载地址(选Java SE 8u261)：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
jdk1.8，linux版本: https://pan.baidu.com/s/1AIH1KTwJFMC2KhypiCRDVg 密码: s31c



# 二、习题：
- 计算机网络，主要由网络软件、网络硬件组成。
- 中继系统中，中继器属于物理层。
- 一个以太网帧的**最小和最大尺寸**是64和1518字节。
- TCP/IP体系中，解决计算机之间通信问题的是**网际层**。
- OSI参考模型中，自下而上提供**端到端服务**的是**运输层**。端到端指两计算机进程之间。
- 网络协议主要要素为：语法（数据与控制信息的结构或格式）、语义（需发出何种控制信息）、同步（事件实现顺序的详细说明）。
- **交换机**在VLAN中的作用：实现VLAN的划分、交换VLAN成员信息、VLAN内进行数据帧的交换。
- 衡量计算机网络性能的两个重要**指标**：带宽和时延。
- 数据是运送信息的载体，**信号**则是数据的电气或电磁表现。
- 实现系统间**二进制块**正确传输的是**数据链路层**。
- RS232-C是一个物理层通信接口！

- 数据链路层功能包括：线路控制、**流量控制**、差错控制。
>流量控制：主要作用是为了防止丢帧和减轻网络负担，路由器缓冲区不足会更容易造成分组丢失，导致相应主机重传该分组，增加网络负担。网桥则属于扩展局域网使用，不会造成网络拥塞。
- 短帧过多会使网络效率大大降低。
- HDLC协议：（1）信息帧【I帧】：传送有效信息或数据。（2）监控帧【s帧】：差错控制和流量控制。（3）无编号帧【U帧】：提供对链路的建立，拆除以及多种控制功能。
- 若A类网络的子网为`16b`(第1个网络号不算在内)，那么网络号就有24位，即子网掩码为255.255.255.0。
- 若B类网络的子网为`8b`（前2个网络号不算在内），那么网络号也有24位，即子网掩码为255.255.255.0。
- **异构网络**：数据链路层和物理层均不同。
- 网络层主要设备：路由器、三层交换机。
- ipv4地址如何转为ipv6表示？？？
- 进程通信**标识**需要一个**五元组**表示。
- www浏览器是由一组客户、一组解释单元与一个**控制单元**组成。

**题1**：某信道带宽为10kHz,编码采用32种不同物理状态来表示数据，问无噪声环境下，该信道最大数据传输速率是？
>解析：W=kHz，根据奈奎斯特定理[^a1]，**波特率**[^a2]`B=2W=20kHz`，无噪声环境最大数据传输率$R=B\log_2M=20*10^3\log_220=100kbps$#M为编码模式数目32。

题2：带宽为4kHz的信道上，有4中不同物理状态来表示数据，若信噪比S/N=30dB，则该信道最大传输速率为？
>解析：有噪声情况，计算公式与上面不一样。$S/N=30dB=10^3$
>最大数据传输率：$C=W\log_2(1+S/N)=4kHz*\log_2(1+10^3) \approx 4*10=40kbps=4*10^4bps$

**题3**：一信道比特率为4kb/s，传播延迟为20ms，问帧大小在多大范围内，**停止等待协议**至少有50%效率？
>解析：<b c=v>缓存号一帧之后开始发送，但在信道口是逐个字节发送的</b>，信道利用率=传播时延/(传播时延+发送时延)。
>因为停止等待协议，发送一帧数据后，要等待对方发确认帧，而题中确认帧不算处理时间和确认帧长，所以不计算确认帧发送时间，但确认帧还有个传播时延。
>信道利用率=`(帧传播时延+确认帧传播时延)` / (帧传播时延+确认帧传播时延+帧发送时延)#两个时延一样大小。得： `帧长=40/0.25=160b`

**题4**：一个B类地址的子网掩码为255.255.240.0每一个子网中的主机数最多是？
>解析：将240转为二进制表示：`240=128+64+32+16=01111000`#(8位表示)，4,5,6,7位表示它子网个数。在1,2,3,8位上不为0的ip地址就是其所属子网号。
>再加上后面8位主机号，`2^(4+8)=4096`个，但要出去全0的本机号，全1的本地广播号。则剩4094个。

题4.1：一台主机ip地址为192.168.0.10,子网掩码为255.255.255.224，求主机所在网络的网络号所占位数。
>解析：从子网掩码看，这明显是一个c类地址，只有最后一段还可划分主机位数来使用，224转为二进制为`11100000`
>其中前3位已经固定，后面5位还可变化为不同的主机号，所以所处网络`网络号位数=8+8+8+3=27`。

题4.2：两个CIDR地址块，A=208.128.0.0/11，B=208.130.28.0/22，的关系？
>解析：A的前缀为`11010000100`#11位，B的前缀为：`1101000010000010000101`#22位，所以A地址块包含了B。

题5：假设允许的最大报文段长度为64字节，序号用8b表示，报文段在网络中生存的时间为30s，则每一条TCP连接的最高数据率是？
>解析：8b即为8位，最大序号为255，因为序号使**用完后又会从第一个序号开始**编号使用，<b c=gy>但同一序号不能再同一网络传输中使用，所以每次最多传255个报文段。</b>
>`最高数据率=255*64*8/(20*1024)`#可将除数部分的1024换成1000，便于计算。

题5.1：设TCP使用的最大窗口为64KB，传输信道的宽带可认为是不受限制的，若报文段平均时延为20ms，则最大**吞吐量**是？
>解析：这里的报文段平均时延就包含了发送，等待时延等。
>**一个窗口包含该次所要发送的全部序列数据**，`64KB=64x1024B=64x1024x8b`所以：`吞吐量=64x1024x8b/(20*1024^2)=26.21Mb/s`

**题5.2**：一个TCP连接下面使用256kb/s的链路，其端到端时延为128ms。测试发现吞吐量只有120kb/s，试问发送窗口是多少？
>解析：因为给出了带宽，所以要计算发送时延。
>设发送窗口大小为C。`吞吐率=窗口数据量 / （发送时延+传播时延）= 8C / [8C/256 + 256x10^-3]=120x10^3`#计算出C即可。

题5.3：分组交换网中，要传送的数据总共1000B，每个分组长度为100B，数据发送速率为100Mb/s，从源头到终点经过5段链路，每段长1Km，数据信号传播速率为`1x10^5km/s`，计算传输总时延（忽略处理时延和排队时延）。
>解析：<b c=b>从第1个分组到最后一个分组发送完用的时间为发送时延</b>。<i c=v>所有分组经过5个链路传输的时间为传播时延。</i>
>每个分组发送时延`=T1=100x8 / 100Mb/s =8μs`，则总发送时延=80μs。<b c=r>每两端链路间还有1个交换设备</b>，经过设备还要算上发送时延。
>所以有4台交换设备。`传播时延=4T1+5x1000m / (1000x10^5m/s) = 50μs`。

题5.4：一台主机正通过一条10Gbit/s的信道发送65535字节的满窗口数据，信道往返延迟为1ms，不考虑数据处理时间，TCP连接可达的最大数据吞吐量是（用32位标记序号，生存时间120s）？
>解析：TCP报文数据段一次最大只能发送65495个字节，65535-20>65495，所以需要两次发送。往返是因为还要接收确认帧。还要加上发送时延
>两次字节数=`C=65535+20x2x2`#ip数据报的首部20字节，TCP首部20字节，两次。`吞吐量=C/[C/10x1024^2 / 8] + 2ms`#/8是位转为字节，`x1024^2`是转为B。2ms是两次的往返时延

题6：某网络中路由器A的路由表如下：

|  目的网络   |  距离（路由跳数）   |  下一条路由（路由器）   |
| :-: | :-: | :-: |
|  网络1   |  4   |  B   |
|  网络2   |  2   |  C   |
|  网络3   |  1   |  F   |
|  网络4   |  5   |  G   |
路由A收到路由C发来的消息：给出更新后的路由表。

|  目的网络   |  距离（路由跳数）   |
| :-: | :-: |
|  网络1   |  2   |
|  网络2   |  1   |
|  网络3   |  3   |
>解析：根据c的消息，取最短距离的路由，更新其下一跳地址（路由器）和距离。得到：

|  目的网络   |  距离（路由跳数）   |  下一条路由（路由器）   |
| :-: | :-: | :-: |
|  网络1   |  3   |  C   |
|  网络2   |  2   |  C   |
|  网络3   |  1   |  F   |
|  网络4   |  5   |  G   |
A到网1原要四跳，但C到网1只要2跳，A到C1跳，所以更新其为2+1=3跳，下一跳为C。<b c=r>每两个路由器之间只算1跳</b>

题7：把一下IPV6地址用零压缩方式简写，0000:0000:0000:AF36:7328:0000:0398，2819:00AF:0000:0000:0035:0CB2:B271。
>解析：简写为：`::AF36:7328:0:398`和`2819:AF::35:CB2:B271`

题8：某网络能传送的最大数据长度为1500字节，假设有一数据，其长度为4000字节，应对数据怎样传输？数据字段长度，片偏移字段多少？
>解析：数据已经超过最大传输长度，进行分片传输，每片按ip数据报格式封装传输即可。每片ip报文**首部固定长20字节**，数据则长1480字节，详细如下：

|   片段    | 总长度（字节） | 数据长度（字节） | AM  | 片偏移 |
| :-------: | :-----------: | :-------------: | :-: | :----: |
| 数据报片1 |     1500      |      1480       |  1  |   0    |
| 数据报片2 |     1500      |      1480       |  1  |  185   |
| 数据报片3 |     1040      |      1020       |  0  |  370   |
>注：<b c=r>片偏移是按字节数 / 8来计算的，数据长度选取应按最大，且能被8整除的条件选取</b>,AM为1表示后面还有数据，0表示已是最后一段。

计算机网络资源：[资源1](https://wenku.baidu.com/view/fee13e61ef06eff9aef8941ea76e58fafab0452c.html)、[资源2](https://wenku.baidu.com/view/78b9a95777232f60ddcca1d3.html)




[^a1]: 奈奎斯特定理：它为采样率建立了一个足够的条件，该采样率允许离散采样序列从有限带宽的连续时间信号中捕获所有信息。
[^a2]: 波特率：表示单位时间内传送的码元符号的个数，它是对符号传输速率的一种度量。